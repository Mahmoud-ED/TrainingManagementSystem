@model TrainingManagementSystem.ViewModels.TrainerVM

@{
    ViewData["Title"] = "إضافة مدرب جديد";
}

@* يمكنك إضافة هذا إذا كنت ستضمن Select2 CSS هنا فقط وليس في _Layout.cshtml *@
@*
@section Styles {
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" />
    <style>
        /* لتصحيح عرض select2 مع input-group-outline */
        .select2-container--bootstrap-5 .select2-selection {
            border: 1px solid #d2d6da; /* لون مشابه لـ input-group-outline */
            min-height: calc(1.5em + 1rem + 2px); /* ارتفاع مشابه */
            padding: .5rem .75rem;
            border-radius: .375rem; /* border-radius مشابه */
        }
        .input-group.input-group-outline.is-focused .select2-container--bootstrap-5 .select2-selection,
        .input-group.input-group-outline.is-filled .select2-container--bootstrap-5 .select2-selection {
            border-color: #e91e63; /* لون التركيز الأساسي في Material Dashboard، يمكن تعديله */
            box-shadow: inset 0 0 0 1px #e91e63;
        }
        .input-group .select2-container--bootstrap-5 {
            width: 100% !important; /* لجعل Select2 يملأ العرض داخل input-group */
        }
    </style>
}
*@

<div class="row">
    <div class="col-lg-9 col-md-12 mx-auto">
        @* توسيع العمود قليلاً *@
        <div class="card my-4">
            <div class="card-header p-0 position-relative mt-n4 mx-3 z-index-2">
                <div class="bg-gradient-primary shadow-primary border-radius-lg pt-4 pb-3">
                    <h6 class="text-white text-capitalize ps-3"><i class="material-symbols-rounded opacity-10 me-2">person_add</i>@ViewData["Title"]</h6>
                </div>
            </div>
            <div class="card-body px-4 pb-3">
                <form asp-action="Create" method="post" enctype="multipart/form-data">
                    @Html.AntiForgeryToken()
                    <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

                    <h6 class="text-dark text-sm mt-2 mb-3">المعلومات الأساسية</h6>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label asp-for="ArName" class="form-label"></label>
                            <div class="input-group input-group-outline">
                                <input asp-for="ArName" class="form-control" />
                            </div>
                            <span asp-validation-for="ArName" class="text-danger text-xs"></span>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label asp-for="EnName" class="form-label"></label>
                            <div class="input-group input-group-outline">
                                <input asp-for="EnName" class="form-control" />
                            </div>
                            <span asp-validation-for="EnName" class="text-danger text-xs"></span>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label asp-for="PhoneNo" class="form-label"></label>
                            <div class="input-group input-group-outline">
                                <span class="input-group-text"><i class="material-symbols-rounded">call</i></span>
                                <input asp-for="PhoneNo" class="form-control" placeholder="مثال: 05xxxxxxxx" />
                            </div>
                            <span asp-validation-for="PhoneNo" class="text-danger text-xs"></span>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label asp-for="Email" class="form-label"></label>
                            <div class="input-group input-group-outline">
                                <span class="input-group-text"><i class="material-symbols-rounded">mail</i></span>
                                <input asp-for="Email" class="form-control" type="email" placeholder="example@domain.com" />
                            </div>
                            <span asp-validation-for="Email" class="text-danger text-xs"></span>
                        </div>
                    </div>

                    <h6 class="text-dark text-sm mt-3 mb-3">المعلومات الإضافية</h6>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label asp-for="NationalNo" class="form-label"></label>
                            <div class="input-group input-group-outline">
                                <input asp-for="NationalNo" class="form-control" />
                            </div>
                            <span asp-validation-for="NationalNo" class="text-danger text-xs"></span>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label asp-for="Employer" class="form-label"></label>
                            <div class="input-group input-group-outline">
                                <input asp-for="Employer" class="form-control" />
                            </div>
                            <span asp-validation-for="Employer" class="text-danger text-xs"></span>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label asp-for="QualificationId" class="form-label"></label>
                        <div class="input-group input-group-outline">
                            @* استخدام id لتطبيق Select2 *@
                            <select asp-for="QualificationId" id="qualificationSelect" class="form-control select2-basic" asp-items="@Model.QualificationsList">
                                <option value="">-- اختر المؤهل --</option>
                            </select>
                        </div>
                        <span asp-validation-for="QualificationId" class="text-danger text-xs"></span>
                    </div>

                    <div class="mb-3">
                        <label asp-for="SelectedSpecializationIds" class="form-label"></label>
                        <div class="input-group input-group-outline">
                            @* استخدام id لتطبيق Select2 *@
                            <select asp-for="SelectedSpecializationIds" id="specializationSelect" class="form-control select2-multiple" asp-items="@Model.SpecializationsList" multiple="multiple">
                            </select>
                        </div>
                        <span asp-validation-for="SelectedSpecializationIds" class="text-danger text-xs"></span>
                        @* الملاحظة لم تعد ضرورية مع Select2 *@
                        @* <small class="form-text text-muted">يمكنك اختيار أكثر من تخصص بالضغط على Ctrl (أو Cmd على Mac) مع النقر.</small> *@
                    </div>


                    <div class="mb-3">
                        <label asp-for="CVFile" class="form-label"></label>
                        <div class="input-group input-group-outline">
                            <span class="input-group-text"><i class="material-symbols-rounded">attach_file</i></span>
                            <input asp-for="CVFile" class="form-control" type="file" />
                        </div>
                        <span asp-validation-for="CVFile" class="text-danger text-xs"></span>
                    </div>



                    <div class="col-md-6">
                        <!-------------------------------------File&Image------------------------------------------------------>
                        <div class="form-group">
                            <label class="control-label">ProfileImage</label>
                            <input id="input1" type="file" asp-for="ProfileImageUrl" onchange="UploadImageFile(this,'img1','isImg1');" class="form-control custom-file-input" />
                            <input type="hidden" name="isImg1" id="isImg1" value="..." />
                        </div>

                        <div class="form-group">
                            <button type="button" class="btn-close" aria-label="Close" onclick="return clearFile('input1','img1','isImg1');"></button>
                            @if (Model != null)
                            {
                                if (Model.ProfileImageUrl != null)
                                {
                                    <img id="img1" src="~/pictures/trainers/@Model.ProfileImageUrl" onclick="return clickFile('input1');" style="width:100%;height:300px" class="img-thumbnail" />
                                    <input type="hidden" asp-for="@Model.ProfileImageUrl" />
                                }
                                else
                                {
                                    <img id="img1" src="~/img/OIP.jpeg" onclick="return clickFile('input1');" style="width:100%;height:300px" class="img-thumbnail" />
                                }
                            }
                            else
                            {
                                <img id="img1" src="~/img/OIP.jpeg" onclick="return clickFile('input1');" style="width:100%;height:300px" class="img-thumbnail" />
                            }
                        </div>
                        <!------------------------------------------------------------------------------->
                    </div>

                    <hr class="dark horizontal my-4">

                    <div class="d-flex justify-content-end mt-4">
                        <a asp-action="Index" class="btn btn-outline-secondary me-2">
                            <i class="material-symbols-rounded opacity-10 me-1"></i> إلغاء
                        </a>
                        <button type="submit" class="btn bg-gradient-primary">
                            <i class="material-symbols-rounded opacity-10 me-1"></i> حفظ المدرب
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
        <script src="~/js/inputfileimage.js"></script>
    }
    @* يمكنك إضافة هذا إذا كنت ستضمن Select2 JS هنا فقط وليس في _Layout.cshtml *@
    <script>
        $(document).ready(function () {
            // تهيئة Select2 للقائمة المنسدلة الفردية (المؤهل)
            $('#qualificationSelect').select2({
                theme: "bootstrap-5", // استخدام ثيم bootstrap 5
                placeholder: "-- اختر المؤهل --",
                allowClear: true,
                dropdownParent: $('#qualificationSelect').parent() // مهم إذا كان Select2 داخل Modal أو عناصر معقدة
            });

            // تهيئة Select2 للقائمة المنسدلة متعددة الاختيارات (التخصصات)
            $('#specializationSelect').select2({
                theme: "bootstrap-5",
                placeholder: "-- اختر التخصصات --",
                allowClear: true, // يسمح بإزالة كل الاختيارات إذا لم يكن هناك شيء محدد
                // closeOnSelect: false, // لإبقاء القائمة مفتوحة بعد كل اختيار (مفيد للمتعدد)
                dropdownParent: $('#specializationSelect').parent()
            });

            // Material Dashboard يتلاعب بالـ label عند التركيز، قد تحتاج لتعديل بسيط لـ Select2
            // للتأكد من أن label يرتفع بشكل صحيح عند فتح select2
            $('.select2-basic, .select2-multiple').on('select2:open', function (e) {
                $(this).closest('.input-group.input-group-outline').addClass('is-focused is-filled');
            });
            $('.select2-basic, .select2-multiple').on('select2:close', function (e) {
                if ($(this).val() === null || $(this).val() === '' || ($(this).attr('multiple') && $(this).val().length === 0) ) {
                     $(this).closest('.input-group.input-group-outline').removeClass('is-focused is-filled');
                } else {
                     $(this).closest('.input-group.input-group-outline').addClass('is-filled').removeClass('is-focused');
                }
            });
             // عند التحميل الأولي إذا كانت هناك قيمة
            $('.select2-basic, .select2-multiple').each(function() {
                if ($(this).val() !== null && $(this).val() !== '' && (!$(this).attr('multiple') || $(this).val().length > 0)) {
                    $(this).closest('.input-group.input-group-outline').addClass('is-filled');
                }
            });
        });

    </script>
}