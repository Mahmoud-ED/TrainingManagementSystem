@model TrainingManagementSystem.ViewModels.TrainerVM

@{
    ViewData["Title"] = "إضافة مدرب جديد";
}

<!-- Breadcrumbs (إذا كنت تستخدمه) -->
<div class="breadcrumbs overlay" style="background-image: url('@Url.Content("~/mediplus_theme/img/breadcrumb-bg.jpg")');">
    <div class="container">
        <div class="bread-inner">
            <div class="row">
                <div class="col-12">
                    <h2>@ViewData["Title"]</h2>
                    <ul class="bread-list">
                        <li><a asp-controller="Admin" asp-action="Index">لوحة التحكم</a></li>
                        <li><i class="icofont-simple-right"></i></li>
                        <li><a asp-controller="Trainer" asp-action="Index">المدربين</a></li>
                        <li><i class="icofont-simple-right"></i></li>
                        <li class="active">@ViewData["Title"]</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- End Breadcrumbs -->

<section class="appointment single-page section">
    <div class="container">
        <div class="row">
            <div class="col-lg-10 col-md-12 col-12 mx-auto">
                <!-- تم توسيط العمود قليلاً -->
                <div class="appointment-inner">
                    <div class="title text-center mb-4">
                        <h3><i class="icofont-teacher"></i> تفاصيل المدرب الجديد</h3>
                        <p>يرجى ملء جميع الحقول المطلوبة بعناية.</p>
                    </div>

                    <form asp-action="Create" method="post" enctype="multipart/form-data" class="form">
                        @Html.AntiForgeryToken()
                        <div asp-validation-summary="ModelOnly" class="alert alert-danger text-center p-2 mb-3" role="alert"></div>

                        <h5 class="form-section-title">المعلومات الأساسية</h5>
                        <hr class="mt-1 mb-3">

                        <div class="row">
                            <div class="col-lg-6 col-md-6 col-12">
                                <div class="form-group mb-3">
                                    <label asp-for="ArName" class="form-label"></label>
                                    <input asp-for="ArName" class="form-control" placeholder="الاسم باللغة العربية" />
                                    <span asp-validation-for="ArName" class="text-danger d-block mt-1 small"></span>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-6 col-12">
                                <div class="form-group mb-3">
                                    <label asp-for="EnName" class="form-label"></label>
                                    <input asp-for="EnName" class="form-control" placeholder="الاسم باللغة الإنجليزية (اختياري)" />
                                    <span asp-validation-for="EnName" class="text-danger d-block mt-1 small"></span>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-6 col-md-6 col-12">
                                <div class="form-group mb-3">
                                    <label asp-for="PhoneNo" class="form-label"></label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="icofont-phone"></i></span>
                                        <input asp-for="PhoneNo" class="form-control" placeholder="مثال: 09xxxxxxxx" />
                                    </div>
                                    <span asp-validation-for="PhoneNo" class="text-danger d-block mt-1 small"></span>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-6 col-12">
                                <div class="form-group mb-3">
                                    <label asp-for="Email" class="form-label"></label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="icofont-email"></i></span>
                                        <input asp-for="Email" class="form-control" type="email" placeholder="example@domain.com" />
                                    </div>
                                    <span asp-validation-for="Email" class="text-danger d-block mt-1 small"></span>
                                </div>
                            </div>
                        </div>

                        <h5 class="form-section-title mt-4">المعلومات الإضافية</h5>
                        <hr class="mt-1 mb-3">

                        <div class="row">
                            <div class="col-lg-6 col-md-6 col-12">
                                <div class="form-group mb-3">
                                    <label asp-for="NationalNo" class="form-label"></label>
                                    <input asp-for="NationalNo" class="form-control" placeholder="الرقم الوطني (اختياري)" />
                                    <span asp-validation-for="NationalNo" class="text-danger d-block mt-1 small"></span>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-6 col-12">
                                <div class="form-group mb-3">
                                    <label asp-for="Employer" class="form-label"></label>
                                    <input asp-for="Employer" class="form-control" placeholder="جهة العمل (اختياري)" />
                                    <span asp-validation-for="Employer" class="text-danger d-block mt-1 small"></span>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-6 col-md-6 col-12">
                                <div class="form-group mb-3">
                                    <label asp-for="QualificationId" class="form-label"></label>
                                    <select asp-for="QualificationId" id="qualificationSelect" class="form-control select2-basic" asp-items="@Model.QualificationsList">
                                        <option value="">-- اختر المؤهل --</option>
                                    </select>
                                    <span asp-validation-for="QualificationId" class="text-danger d-block mt-1 small"></span>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-6 col-12">
                                <div class="form-group mb-3">
                                    <label asp-for="SelectedSpecializationIds" class="form-label"></label>
                                    <select asp-for="SelectedSpecializationIds" id="specializationSelect" class="form-control select2-multiple" asp-items="@Model.SpecializationsList" multiple="multiple">
                                    </select>
                                    <span asp-validation-for="SelectedSpecializationIds" class="text-danger d-block mt-1 small"></span>
                                </div>
                            </div>
                        </div>

                        <h5 class="form-section-title mt-4">الملفات المرفقة</h5>
                        <hr class="mt-1 mb-3">

                        <div class="row">
                            <div class="col-lg-6 col-md-6 col-12">
                                <div class="form-group mb-3">
                                    <label asp-for="CVFile" class="form-label"></label>
                                    <div class="input-group">
                                        <input asp-for="CVFile" class="form-control" type="file" id="cvFileInput" />
                                        <label class="input-group-text" for="cvFileInput"><i class="icofont-file-document"></i></label>
                                    </div>
                                    <span asp-validation-for="CVFile" class="text-danger d-block mt-1 small"></span>
                                    <small class="form-text text-muted">الملفات المسموح بها: PDF, DOC, DOCX (الحجم الأقصى: 5MB)</small>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-6 col-12">
                                <div class="form-group mb-3">
                                    <label asp-for="ProfileImageFile" class="form-label">الصورة الشخصية</label>
                                    <div class="input-group">
                                        <input id="input1" type="file" asp-for="ProfileImageFile" onchange="UploadImageFile(this,'img1','isImg1');" class="form-control custom-file-input" />
                                        <label class="input-group-text" for="input1"><i class="icofont-image"></i></label>
                                    </div>
                                    <input type="hidden" name="isImg1" id="isImg1" value="@(string.IsNullOrEmpty(Model.ProfileImageUrl) ? "false" : "true")" />
                                    <span asp-validation-for="ProfileImageFile" class="text-danger d-block mt-1 small"></span>
                                </div>
                                <div class="form-group mt-2 text-center position-relative">
                                    <img id="img1" src="@(string.IsNullOrEmpty(Model.ProfileImageUrl) ? Url.Content("~/mediplus_theme/img/default-avatar.png") : Url.Content("~/pictures/trainers/" + Model.ProfileImageUrl))"
                                         onclick="return clickFile('input1');"
                                         style="max-width:150px; max-height:150px; object-fit: cover; cursor:pointer; border-radius: 50%; border: 2px solid #eee;"
                                         class="img-thumbnail d-block mx-auto mb-2" alt="الصورة الشخصية" />
                                    @if (!string.IsNullOrEmpty(Model.ProfileImageUrl) || true)
                                    {
                                        <button type="button" class="btn-close" aria-label="Close"
                                                onclick="return clearFile('input1','img1','isImg1', '@Url.Content("~/mediplus_theme/img/default-avatar.png")');"
                                                title="إزالة الصورة"
                                                style="position: absolute; top: 0; right: 20%; transform: translate(50%, -50%); background-color: white; border-radius: 50%; padding: 0.2rem 0.35rem; z-index:10; box-shadow: 0 .125rem .25rem rgba(0,0,0,.075);"></button>
                                    }
                                    <input type="hidden" asp-for="ProfileImageUrl" /> <!-- للحفاظ على المسار إذا كان موجودًا ولم يتم تغيير الملف -->
                                </div>
                            </div>
                        </div>

                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="form-group">
                                    <div class="button d-flex justify-content-center gap-2">
                                        <!-- استخدام gap لتوفير مسافة -->
                                        <a asp-action="Index" class="btn btn-secondary">
                                            <i class="icofont-close-line-circled"></i> إلغاء
                                        </a>
                                        <button type="submit" class="btn btn-primary">
                                            <i class="icofont-save"></i> حفظ المدرب
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>


@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
        <script src="~/js/inputfileimage.js"></script>
    }
    <script>
        $(document).ready(function () {
            if ($.fn.select2) { // تحقق من وجود مكتبة Select2
                // تهيئة Select2 للقائمة المنسدلة الفردية (المؤهل)
                $('#qualificationSelect').select2({
                    theme: "bootstrap-5",
                    placeholder: "-- اختر المؤهل --",
                    allowClear: true,
                    width: '100%',
                    // dropdownParent: $('#qualificationSelect').closest('.form-group') // أفضل لـ Bootstrap 5
                });

                // تهيئة Select2 للقائمة المنسدلة متعددة الاختيارات (التخصصات)
                $('#specializationSelect').select2({
                    theme: "bootstrap-5",
                    placeholder: "-- اختر التخصصات --",
                    allowClear: true,
                    width: '100%',
                    // dropdownParent: $('#specializationSelect').closest('.form-group')
                });
            } else {
                console.error("Select2 is not loaded.");
            }

            // لتحديث اسم الملف في حقل الإدخال المخصص (إذا كنت تستخدم Bootstrap 5 custom file input)
             $('#cvFileInput').on('change',function(e){
                var fileName = e.target.files[0].name;
                $(this).next('.input-group-text').html('<i class="icofont-file-document"></i> ' + fileName.substring(0,15) + (fileName.length > 15 ? '...' : ''));
            })
        });

        // تعديل بسيط على دالة clearFile لتقبل مسار الصورة الافتراضية
        function clearFile(fileElementId, imgElementId, isImgHiddenId, defaultImgSrc) {
            document.getElementById(fileElementId).value = ""; // مسح قيمة input file
            document.getElementById(imgElementId).src = defaultImgSrc; // تعيين الصورة الافتراضية
            document.getElementById(isImgHiddenId).value = "false"; // أو أي قيمة تشير إلى عدم وجود صورة
            // إذا كان لديك حقل مخفي لـ ProfileImageUrl وتريد مسحه أيضًا
            // var hiddenImageUrlField = document.querySelector('input[type="hidden"][name$="ProfileImageUrl"]');
            // if(hiddenImageUrlField) hiddenImageUrlField.value = "";
            return false;
        }

        // تعديل على دالة UploadImageFile إذا لزم الأمر (عادةً لا تحتاج لتعديل هنا إذا كانت تعمل)
        // function UploadImageFile(input, imgTagId, isImgHiddenId) { ... }
        // function clickFile(fileElementId) { ... }
    </script>
}